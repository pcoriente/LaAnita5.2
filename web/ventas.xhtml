<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></meta>
        <title>Ventas Oficina</title>
        <h:outputStylesheet library="css" name="main.css"/>
    </h:head>
    <body>
        <ui:include src="wrapper.xhtml" />
        <h:form id="main" onkeypress="return event.keyCode !== 13;" >
            <p:messages id="msgs" autoUpdate="false" showDetail="true" closable="true" />
            <p:panel id="panelVenta" header="Lista de Ventas" style="float: left" >
                <p:panelGrid style="width: 910px;" >
                    <f:facet name="header" >
                        <p:row >
                            <p:column >
                                <h:outputLabel for="almacen" value="ALMACEN :" style="font-weight: bold; color: black;" />
                            </p:column>
                            <p:column >
                                <p:selectOneMenu id="almacen" value="#{mbVentas.mbAlmacenes.toAlmacen}" >
                                    <f:converter converterId="converters.TOAlmacenJSConverter" />
                                    <f:selectItems value="#{mbVentas.mbAlmacenes.listaAlmacenes}" />
                                    <p:ajax event="change" listener="#{mbVentas.obtenerVentas()}" 
                                            update=":main:msgs fechaInicial btnNuevaVenta btnBuscarPedidos listaDeVentas" />
                                </p:selectOneMenu>
                            </p:column>
                            <p:column >
                                <p:selectBooleanCheckbox id="chkTodosLosPedios" value="#{mbVentas.pendientes}"
                                                         itemLabel="PENDIENTES" style="color: black; font-weight: bold; font-size: small;" >
                                    <p:ajax listener="#{mbVentas.obtenerVentas()}" 
                                            update=":main:msgs fechaInicial listaDeVentas" />
                                </p:selectBooleanCheckbox>
                            </p:column>
                            <p:column >
                                <p:calendar id="fechaInicial" value="#{mbVentas.fechaInicial}"
                                            readonlyInput="true" disabled="#{mbVentas.mbAlmacenes.toAlmacen.idAlmacen==0 || mbVentas.pendientes}"
                                            locale="es" navigator="true" pattern="dd/MM/yyyy" >
                                    <p:ajax event="dateSelect" process="@this" listener="#{mbVentas.obtenerVentas()}" 
                                            update=":main:msgs listaDeVentas" />
                                </p:calendar>
                            </p:column>
                            <p:column colspan="5" style="text-align: right;" >
                                <p:commandButton id="btnNuevaVenta" icon="ui-icon-document" title="Nuevo Pedido" 
                                                 disabled="#{mbVentas.mbAlmacenes.toAlmacen.idAlmacen==0}"
                                                 process="@this" actionListener="#{mbVentas.nuevaVenta()}" 
                                                 update=":main:nuevaVenta"
                                                 oncomplete="PF('nuevaVentaDlg').show();" />
                                <p:commandButton id="btnBuscarPedidos" icon="ui-icon-search" title="Buscar pedidos pendientes" 
                                                 disabled="#{mbVentas.mbAlmacenes.toAlmacen.idAlmacen==0}"
                                                 process="@this" actionListener="#{mbVentas.obtenerPedidos()}" 
                                                 update=":main:listaDePedidos" oncomplete="PF('listaDePedidosDlg').show();" />
                                <p:commandButton icon="ui-icon-home" title="Salir" immediate="true" 
                                                 ajax="false" action="#{mbVentas.terminar()}" />
                            </p:column>
                        </p:row>
                    </f:facet>
                </p:panelGrid>
                <p:dataTable id="listaDeVentas" value="#{mbVentas.ventas}"  
                             var="vta" rowKey="#{vta.idMovto}" selectionMode="single" 
                             style="border:solid 1px; width: 910px;" emptyMessage="No existen pedidos" >
                    <p:ajax event="rowSelect" listener="#{mbVentas.obtenerDetalle}" 
                            update=":main:msgs :main:venta :main:detalleVenta :main:totales" 
                            oncomplete="abrirVenta(xhr, status, args);" />

                    <p:column headerText="Cliente" style="width: 30%;" >
                        <h:outputText value="#{vta.tienda.contribuyente}" />
                    </p:column>
                    <p:column headerText="Tienda" style="width: 30%;" >
                        <h:outputText value="#{vta.tienda.tienda}" />
                    </p:column>
                    <p:column headerText="Remisión" style="width: 7%;" >
                        <h:outputText value="#{vta.folio}" />
                    </p:column>
                    <p:column headerText="Fecha" style="width: 8%;" >
                        <h:outputText value="#{vta.fecha}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" type="date" timeZone="#{mbVentas.zonaHoraria.ID}" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Pedido" style="width: 6%;" >
                        <h:outputText value="#{vta.idPedido}" />
                    </p:column>
                </p:dataTable>
            </p:panel>
            <p:dialog header="Edicion" widgetVar="EdicionDlg" closable="false" resizable="false" style="width: 600px;" modal="true" >
                <p:ajax event="close" update=":main:detalleVenta :main:totales" />
                <p:messages id="msgsEdicion" showDetail="true" closable="true" />
                <p:panelGrid id="panelEdicion" styleClass="sinBorde" >
                    <p:row >
                        <p:column >
                            <h:outputLabel for="txtProducto" value="PRODUCTO :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="4" >
                            <p:inputText id="txtProducto" value="#{mbVentas.producto.toString()}" size="80" readonly="true" />
                        </p:column>
                    </p:row>
                    <p:row rendered="#{mbVentas.venta.idPedido!=0}" >
                        <p:column >
                            <h:outputLabel for="txtOrdenada" value="CANT.ORDENADA :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column >
                            <p:inputText id="txtOrdenada" value="#{mbVentas.producto.cantOrdenada}" size="14" readonly="true" >
                                <f:convertNumber pattern="###,##0.000" />
                            </p:inputText>
                        </p:column>
                        <p:column >
                            <h:outputLabel for="txtOrdenadaSinCargo" value="ORD. SIN CARGO :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="2" >
                            <p:inputText id="txtOrdenadaSinCargo" value="#{mbVentas.producto.cantOrdenadaSinCargo}" size="14" readonly="true" >
                                <f:convertNumber pattern="###,##0.000" />
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column >
                            <h:outputLabel value="CANT.FACTURADA :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column >
                            <p:inputText value="#{mbVentas.producto.cantFacturada}" size="14" >
                                <p:ajax event="change" process="@this" listener="#{mbVentas.actualizarProductoCantidad()}" 
                                        update=":main:msgsEdicion panelEdicion" 
                                        oncomplete="handleEdicion(xhr, status, args);" />
                            </p:inputText>
                        </p:column>
                        <p:column >
                            <h:outputLabel for="txtSinCargo" value="CANT.SIN CARGO :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column >
                            <p:inputText id="txtSinCargo" value="#{mbVentas.producto.cantSinCargo}" 
                                         size="14" maxlength="12" readonly="#{mbVentas.venta.idPedido==0}" >
                                <f:convertNumber pattern="###,##0.0000" />
                                <p:ajax event="change" process="@this" listener="#{mbVentas.actualizarProductoSinCargo()}"
                                        update=":main:msgsEdicion panelEdicion" 
                                        oncomplete="" />
                            </p:inputText>
                        </p:column>
                        <p:column style="text-align: right;" >
                            <p:commandButton id="btnTraspasoSimilares" value="Cambiar" title="Cambiar sin canrgo a otro similar" 
                                             disabled="#{mbVentas.producto.cantSinCargo==0}"
                                             actionListener="#{mbVentas.traspasoSimilar()}" 
                                             oncomplete="handleAbrirSimilares(xhr, status, args);" />
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column >
                            <h:outputLabel for="txtPrecio" value="PRECIO LISTA :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column >
                            <p:inputText id="txtPrecio" value="#{mbVentas.producto.costo}" size="14" readonly="true" >
                                <f:convertNumber pattern="###,##0.000000" />
                            </p:inputText>
                        </p:column>
                        <p:column >
                            <h:outputLabel for="txtDescto" value="DESCUENTO :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="2" >
                            <p:inputText id="txtDescto" value="#{mbVentas.producto.desctoProducto1}" size="8" readonly="true" >
                                <f:convertNumber pattern="###,##0.000000" />
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column >
                            <h:outputLabel for="txtUnitario" value="PRECIO UNITARIO :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column >
                            <p:inputText id="txtUnitario" value="#{mbVentas.producto.unitario}" size="14" readonly="true" >
                                <f:convertNumber pattern="###,##0.000000" />
                            </p:inputText>
                        </p:column>
                        <p:column >
                            <h:outputLabel for="txtNeto" value="PRECIO NETO :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="2" >
                            <p:inputText id="txtNeto" value="#{mbVentas.producto.neto}" size="14" readonly="true" >
                                <f:convertNumber pattern="###,##0.000000" />
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <f:facet name="footer" >
                        <p:row >
                            <p:column colspan="5" style="text-align: right;" >
                                <p:commandButton icon="ui-icon-arrowreturnthick-1-w" value="Salir" title="Fin de edicion" 
                                                 immediate="true" onclick="PF('EdicionDlg').hide();" />
                            </p:column>
                        </p:row>
                    </f:facet>
                </p:panelGrid>
            </p:dialog>
            <p:dialog header="Captura de Venta" widgetVar="ventaDlg" resizable="false" modal="true" >
                <p:ajax event="close" listener="#{mbVentas.liberarVenta()}" />
                <p:messages id="msgsVenta" autoUpdate="false" showDetail="true" closable="true" />
                <p:panelGrid id="venta" style="width: 910px;" >
                    <p:row >
                        <p:column style="width: 80px;" >
                            <h:outputLabel for="txtFormato" value="CLIENTE:" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="3" style="width: 330px;" >
                            <p:inputText id="txtFormato" value="#{mbVentas.venta.tienda.contribuyente}" readonly="true" size="45" />
                        </p:column>
                        <p:column style="width: 90px;" >
                            <h:outputLabel for="txtTienda" value="TIENDA:" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="3" style="width: 400px;" >
                            <p:inputText id="txtTienda" value="#{mbVentas.venta.tienda.tienda}" readonly="true" size="50" />
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column colspan="2" style="width: 180px;" >
                            <h:outputLabel for="ordenDeCompra" value="ORDEN DE COMPRA:" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="2" style="width: 230px;" >
                            <p:inputText id="ordenDeCompra" value="#{mbVentas.venta.ordenDeCompra}" readonly="true" size="29" />
                        </p:column>
                        <p:column style="width: 90px;" >
                            <h:outputLabel for="ordenDeCompraFecha" value="FECHA:" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column style="width: 120px;" >
                            <p:inputText id="ordenDeCompraFecha" value="#{mbVentas.venta.ordenDeCompraFecha}" readonly="true" size="11" >
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" type="date" timeZone="#{mbVentas.zonaHoraria.ID}" />
                            </p:inputText>
                        </p:column>
                        <p:column style="width: 90px;" >
                            <h:outputLabel for="moneda" value="MONEDA:" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column style="width: 190px; text-align: right;" >
                            <p:inputText id="moneda" value="#{mbVentas.venta.comprobante.moneda.moneda}" readonly="true" size="22" />
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column style="width: 80px;" >
                            <h:outputLabel for="txtPedido" value="PEDIDO:" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column style="width: 90px;" >
                            <p:inputText id="txtPedido" value="#{mbVentas.venta.idPedido}" readonly="true" size="6" />
                        </p:column>
                        <p:column style="width: 70px;" >
                            <h:outputLabel for="txtFecha" value="FECHA:" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column style="width: 170px;" >
                            <p:inputText id="txtFecha" value="#{mbVentas.venta.fecha}" readonly="true" size="11" >
                                <f:convertDateTime pattern="dd/MM/yyyy" type="date" timeZone="#{mbVentas.zonaHoraria.ID}" />
                            </p:inputText>
                        </p:column>
                        <p:column colspan="2" style="width: 210px;" >
                            <h:outputLabel for="txtDesctoComercial" value="DESCUENTO COMERCIAL :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column style="width: 90px;" >
                            <p:inputText id="txtDesctoComercial" value="#{mbVentas.venta.desctoComercial}" readonly="true" size="6" />
                        </p:column>
                        <p:column style="width: 190px; text-align: right;" >
                            <p:commandButton id="btnAgregarProducto" icon="ui-icon-search" value="Buscar" title="Buscar productos"
                                             disabled="#{mbVentas.venta.estatus!=0}"
                                             process="@this" actionListener="#{mbVentas.buscarProductos(':main:msgsVenta :main:detalleVenta :main:totales')}" 
                                             oncomplete="PF('buscarProductoDlg').show();" />
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <p:dataTable id="detalleVenta" value="#{mbVentas.detalle}"
                             var="prod" rowKey="#{prod.producto}" selectionMode="single" 
                             style="border:solid 1px; width: 910px;" emptyMessage="No existen productos" >
                    <p:ajax event="rowSelect" listener="#{mbVentas.modificarProducto}"
                            update=":main:msgsVenta :main:panelEdicion" oncomplete="abrirEdicion(xhr, status, args);" />

                    <f:facet name="header" >Detalle de la venta</f:facet>
                    <p:column headerText="SKU" style="width: 50px;" >
                        <h:outputText value="#{prod.producto.cod_pro}" />
                    </p:column>
                    <p:column headerText="Descripción" >
                        <h:outputText value="#{prod.producto.toString()}" />
                    </p:column>
                    <p:column headerText="Con Cargo" style="width: 70px; text-align: right;" >
                        <h:outputText value="#{prod.cantFacturada}" >
                            <f:convertNumber pattern="###,##0.000" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Sin Cargo" style="width: 70px; text-align: right;" >
                        <h:outputText value="#{prod.cantSinCargo}" >
                            <f:convertNumber pattern="#,##0.000" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Precio Lista" style="width: 70px; text-align: right;" >
                        <h:outputText value="#{prod.costo}" >
                            <f:convertNumber pattern="###,##0.000000" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="% Descto" style="width: 55px; text-align: right;" >
                        <h:outputText value="#{prod.desctoProducto1}" >
                            <f:convertNumber pattern="#0.000000" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Unitario" style="width: 70px; text-align: right;" >
                        <h:outputText value="#{prod.unitario}" >
                            <f:convertNumber pattern="#,##0.000000" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Importe" style="width: 80px; text-align: right;" >
                        <h:outputText value="#{prod.cantFacturada*prod.unitario}" >
                            <f:convertNumber pattern="###,##0.000000" />
                        </h:outputText>
                    </p:column>
                </p:dataTable>
                <p:panelGrid id="totales" styleClass="filaSinBorde colSinBorde" >
                    <p:row >
                        <p:column style="width: 600px;" ></p:column>
                        <p:column style="text-align: right; width: 110px;" >
                            <h:outputLabel for="txtSubTotal" value="SUBTOTAL :" style="font-weight: bold; color: black; width: 100px;" />
                        </p:column>
                        <p:column style="text-align: left; width: 160px;" >
                            <p:inputText id="txtSubTotal" value="#{mbVentas.venta.subTotal}" readonly="true" 
                                         style="text-align: right; font-size: 14px; width: 125px;" >
                                <f:convertNumber pattern="##,###,##0.000000" />
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row rendered="#{mbVentas.venta.descuento!=0}" >
                        <p:column ></p:column>
                        <p:column style="text-align: right;" >
                            <h:outputLabel for="txtDescuento" value="DESCUENTO :" style="font-weight: bold; color: black; width: 100px;" />
                        </p:column>
                        <p:column style="text-align: left;" >
                            <p:inputText id="txtDescuento" value="#{mbVentas.venta.descuento}" readonly="true" 
                                         style="text-align: right; font-size: 14px; width: 125px;" >
                                <f:convertNumber pattern="##,###,##0.000000" />
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column ></p:column>
                        <p:column colspan="2" >
                            <p:dataTable value="#{mbVentas.impuestosTotales}" var="xx_imp" style="width: 280px;" >
                                <p:column style="text-align: right; width: 98px;" >
                                    <h:outputText value="#{xx_imp.impuesto} :.." style="font-weight: bold; color: black; font-size: 14px; width: 90px;" />
                                </p:column>
                                <p:column style="width: 135px; text-align: left;" >
                                    <p:inputText value="#{xx_imp.importe}" readonly="true" style="text-align: right; font-size: 14px; width: 125px;" >
                                        <f:convertNumber pattern="##,###,##0.000000" />
                                    </p:inputText>
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column style="text-align: left;" >
                            <p:commandButton id="btnVentaEliminar" icon="ui-icon-trash" value="ELIMINAR" title="Eliminar la venta" 
                                             disabled="#{mbVentas.venta.estatus ge 7 || not mbVentas.ventaAsegurada}"
                                             process="@this" actionListener="#{mbVentas.eliminarVenta()}" 
                                             update=":main:msgs :main:msgs :main:listaDeVentas" 
                                             oncomplete="handleVenta(xhr, status, args);" />
                            <p:commandButton id="btnVentaCerrar" value="CERRAR" title="Cerrar la venta para surtir almacen" 
                                             disabled="#{mbVentas.venta.total==0 || mbVentas.venta.estatus ge 7}"
                                             process="@this" actionListener="#{mbVentas.cerrarVenta()}" 
                                             update=":main:msgsVenta :main:detalleVenta :main:totales" />
                            <p:commandButton id="btnSurtirOC" icon="ui-icon-gear" value="SURTIR OC" title="Surtir Orden de Compra" 
                                             disabled="#{mbVentas.venta.idPedido==0 || mbVentas.venta.estatus ge 7 || not mbVentas.ventaAsegurada}" 
                                             process="@this" actionListener="#{mbVentas.surtirFincado()}"
                                             update=":main:msgsVenta :main:detalleVenta :main:totales" />
                        </p:column>
                        <p:column style="text-align: right;" >
                            <h:outputLabel for="txtTotales" value="TOTAL :" style="font-weight: bold; color: black; width: 100px;" />
                        </p:column>
                        <p:column >
                            <p:inputText id="txtTotales" value="#{mbVentas.venta.total}" readonly="true" 
                                         style="text-align: right; font-size: 14px; width: 125px;" >
                                <f:convertNumber pattern="##,###,##0.000000" />
                            </p:inputText>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </p:dialog>
            <p:dialog widgetVar="listaDePedidosDlg" closable="true" header="Lista de Pedidos pendientes" modal="true" resizable="false" >
                <p:messages id="msgsPedidos" autoUpdate="false" showDetail="true" closable="true" />
                <p:dataTable id="listaDePedidos" value="#{mbVentas.pedidos}"  
                             var="ped" rowKey="#{ped.idPedido}" selectionMode="single" selection="#{mbVentas.venta}"
                             style="border:solid 1px; width: 910px;" emptyMessage="No existen pedidos" >
                    <p:ajax event = "rowSelect" update="btnGenerarVenta" />

                    <p:column headerText="Cliente" style="width: 30%;" >
                        <h:outputText value="#{ped.tienda.contribuyente}" />
                    </p:column>
                    <p:column headerText="Tienda" style="width: 30%;" >
                        <h:outputText value="#{ped.tienda.tienda}" />
                    </p:column>
                    <p:column headerText="Remisión" style="width: 7%;" >
                        <h:outputText value="#{ped.folio}" />
                    </p:column>
                    <p:column headerText="Fecha" style="width: 8%;" >
                        <h:outputText value="#{ped.fecha}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" type="date" timeZone="#{mbVentas.zonaHoraria.ID}" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Pedido" style="width: 6%;" >
                        <h:outputText value="#{ped.idPedido}" />
                    </p:column>

                    <f:facet name="footer">
                        <p:commandButton id="btnGenerarVenta" icon="ui-icon-document" title="Generar venta" 
                                         disabled="#{mbVentas.venta==null}"
                                         process="@this" actionListener="#{mbVentas.generarPedidoVenta()}"
                                         update=":main:msgsVenta :main:venta :main:detalleVenta :main:totales" 
                                         oncomplete="nuevaVenta(xhr, status, args);" />
                    </f:facet>
                </p:dataTable>
            </p:dialog>
            <p:dialog widgetVar="nuevaVentaDlg" closable="true" header="Crear una nueva venta" modal="true" resizable="false" >
                <p:messages id="msgsNuevaVenta" autoUpdate="false" showDetail="true" closable="true" />
                <p:panelGrid id="nuevaVenta" >
                    <p:row >
                        <p:column >
                            <h:outputLabel for="grupo" value="GRUPO :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="3" >
                            <p:selectOneMenu id="grupo" value="#{mbVentas.mbGrupos.clienteGrupoSeleccionado}" 
                                             disabled="#{mbVentas.mbFormatos.formatoSeleccion.idFormato!=0}" >
                                <f:converter converterId="converters.ClientesGrupos" />
                                <f:selectItems value="#{mbVentas.mbGrupos.itemsClientesGrupos}" />
                                <p:ajax event="change" listener="#{mbVentas.cambioDeGrupo()}" 
                                        update=":main:msgsNuevaVenta formato listaTiendas btnCrearVenta" />
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column >
                            <h:outputLabel for="formato" value="FORMATO :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="3" >
                            <p:selectOneMenu id="formato" value="#{mbVentas.mbFormatos.formatoSeleccion}" 
                                             disabled="#{mbVentas.mbGrupos.clienteGrupoSeleccionado.idGrupoCte==0}" >
                                <f:converter converterId="converter.formatos" />
                                <f:selectItems value="#{mbVentas.mbFormatos.lstFormatos}" />
                                <p:ajax event="change" 
                                        listener="#{mbVentas.cambioDeFormato()}" 
                                        update=":main:msgsNuevaVenta grupo listaTiendas btnCrearVenta" />
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column colspan="4" >
                            <p:dataTable id="listaTiendas" widgetVar="listaTiendasDlg" value="#{mbVentas.mbTiendas.tiendas}" 
                                         var="tda" rowKey="#{tda.idTienda}" selectionMode="single" selection="#{mbVentas.mbTiendas.tienda}"
                                         scrollable="true" scrollHeight="200"
                                         style="border:solid 1px; width: 910px;" emptyMessage="No existen tiendas" >
                                <p:ajax event = "rowSelect" update=":main:btnCrearVenta" />

                                <p:column headerText="CLIENTE" style="width: 250px;" >
                                    <h:outputText value="#{tda.contribuyente}" />
                                </p:column>
                                <p:column headerText="TIENDA" style="width: 250px;" >
                                    <h:outputText value="#{tda.toString()}" />
                                </p:column>
                                <p:column headerText="CODIGO" style="width: 40px;" >
                                    <h:outputText value="#{tda.codigoTienda}" />
                                </p:column>
                            </p:dataTable>
                        </p:column>
                    </p:row>
                    <p:row >
                        <p:column >
                            <h:outputLabel for="cboMoneda" value="MONEDA :" style="font-weight: bold; color: black;" />
                        </p:column>
                        <p:column colspan="3" >
                            <p:selectOneMenu id="cboMoneda" value="#{mbVentas.mbComprobantes.mbMonedas.seleccionMoneda}"
                                             style="width: 240px;" >
                                <f:converter converterId="converters.Moneda" />
                                <f:selectItems value="#{mbVentas.mbComprobantes.mbMonedas.listaMonedas}" />
                                <p:ajax event="change" process="@this" />
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                    <f:facet name="footer" >
                        <p:row >
                            <p:column colspan="4" style="text-align: right;" >
                                <p:commandButton id="btnCrearVenta" icon="ui-icon-document" value="Crear" title="Crear venta" 
                                                 disabled="#{mbVentas.mbTiendas.tienda.idTienda==0}"
                                                 process="@this" actionListener="#{mbVentas.crearVenta()}"
                                                 update=":main:msgsNuevaVenta :main:listaDeVentas" 
                                                 oncomplete="nuevaVenta(xhr, status, args);" />
                                <p:commandButton icon="ui-icon-arrowreturnthick-1-w" value="Cancelar" title="Cancelar" 
                                                 immediate="true" onclick="PF('nuevaVentaDlg').hide();" />
                            </p:column>
                        </p:row>
                    </f:facet>
                </p:panelGrid>
            </p:dialog>
        </h:form>
        <script type="text/javascript" >
            function handleSimilares(xhr, status, args) {
                if (!(args.validationFailed || !args.okSimilares)) {
                    PF('SimilaresDlg').hide();
                    PF('EdicionDlg').hide();
                }
            }
            function handleAbrirSimilares(xhr, status, args) {
                if (!(args.validationFailed || !args.okSimilares)) {
                    PF('SimilaresDlg').show();
                }
            }
            function handleEdicion(xhr, status, args) {
                if (!(args.validationFailed || !args.okEdicion)) {
                    PF('EdicionDlg').hide();
                }
            }
            function abrirEdicion(xhr, status, args) {
                if (!(args.validationFailed || !args.okEdicion)) {
                    PF('EdicionDlg').show();
                }
            }
            function handleBuscar(xhr, status, args) {
                if (!(args.validationFailed || !args.okBuscar)) {
                    PF('buscarProductoDlg').hide();
                }
            }
            function handleVenta(xhr, status, args) {
                if (!(args.validationFailed || !args.okPedido)) {
                    PF('ventaDlg').hide();
                }
            }
            function abrirVenta(xhr, status, args) {
                if (!(args.validationFailed || !args.okPedido)) {
                    PF('listaDePedidosDlg').hide();
                    PF('ventaDlg').show();
                }
            }
            function nuevaVenta(xhr, status, args) {
                if (!(args.validationFailed || !args.okPedido)) {
                    PF('nuevaVentaDlg').hide();
                    PF('ventaDlg').show();
                }
            }
        </script>
        <ui:include src="footer.html" />
    </body>
</html>
