<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></meta>
        <title>Ventas Oficina</title>
        <h:outputStylesheet library="css" name="main.css"/>
    </h:head>
    <body>
        <ui:include src="wrapper.xhtml" />
        <h:form id="main" onkeypress="return event.keyCode !== 13;" >
            <p:messages id="msgsVenta" autoUpdate="false" showDetail="true" closable="true" />
            <p:panel id="panelVenta" header="Lista de Pedidos" style="float: left" >
                <p:panelGrid id="venta" style="width: 910px;" >
                    <f:facet name="header" >
                        <p:row >
                            <p:column >
                                <h:outputLabel for="almacen" value="ALMACEN :" style="font-weight: bold; color: black;" />
                            </p:column>
                            <p:column >
                                <p:selectOneMenu id="almacen" value="#{mbVentas.mbAlmacenes.almacen}" >
                                    <f:converter converterId="converters.MiniAlmacenConverter" />
                                    <f:selectItems value="#{mbVentas.mbAlmacenes.listaAlmacenes}" />
                                    <p:ajax event="change" listener="#{mbVentas.obtenerPedidos()}" 
                                            update=":main:msgsVenta fechaInicial btnNuevoPedido listaDePedidos" />
                                </p:selectOneMenu>
                            </p:column>
                            <p:column style="text-align: right;" >
                                <h:outputLabel for="chkTodosLosPedios" value="PENDIENTES :" style="font-weight: bold; color: black;"
                                               title="Ver a la fecha indicada, todos los pedidos o solo los pendientes" />
                            </p:column>
                            <p:column >
                                <p:selectBooleanCheckbox id="chkTodosLosPedios" value="#{mbVentas.pendientes}" >
                                    <p:ajax listener="#{mbVentas.regresarFechaActual()}" 
                                            update=":main:msgsVenta fechaInicial listaDePedidos" />
                                </p:selectBooleanCheckbox>
                            </p:column>
                            <p:column >
                                <p:calendar id="fechaInicial" value="#{mbVentas.fechaInicial}" readonly="#{!mbVentas.pendientes}" 
                                            readonlyInput="true" disabled="#{mbVentas.mbAlmacenes.almacen.idAlmacen==0}"
                                            locale="es" navigator="true" pattern="dd/MM/yyyy" >
                                    <p:ajax event="dateSelect" process="@this" listener="#{mbVentas.obtenerPedidos()}" 
                                            update=":main:msgsVenta listaDePedidos" />
                                </p:calendar>
                            </p:column>
                            <p:column colspan="5" style="text-align: right;" >
                                <p:commandButton id="btnNuevoPedido" icon="ui-icon-document" title="Nuevo Pedido" 
                                                 disabled="#{mbVentas.mbAlmacenes.almacen.idAlmacen==0}"
                                                 process="@this" actionListener="#{mbVentas.nuevoPedido()}" 
                                                 oncomplete="PF('nuevoPedidoDlg').show();" />
                                <p:commandButton icon="ui-icon-home" title="Salir" immediate="true" 
                                                 ajax="false" action="#{mbVentas.terminar()}" />
                            </p:column>
                        </p:row>
                    </f:facet>
                </p:panelGrid>
                <p:dataTable id="listaDePedidos" value="#{mbVentas.pedidos}" 
                             var="pedido" rowKey="#{pedido.idMovto}" selectionMode="single" 
                             style="border:solid 1px; width: 910px;" emptyMessage="No existen pedidos" >
                    <p:ajax event="rowSelect" listener="#{mbVentas.obtenerDetalle}" />

                    <p:column headerText="Cliente" style="width: 30%;" >
                        <h:outputText value="#{pedido.cliente.contribuyente}" />
                    </p:column>
                    <p:column headerText="Formato" style="width: 20%;" >
                        <h:outputText value="#{pedido.formato.formato}" />
                    </p:column>
                    <p:column headerText="Tienda" style="width: 30%;" >
                        <h:outputText value="#{pedido.tienda.tienda}" />
                    </p:column>
                    <p:column headerText="Folio" style="width: 6%;" >
                        <h:outputText value="#{pedido.folio}" />
                    </p:column>
                    <p:column headerText="Fecha" style="width: 8%;" >
                        <h:outputText value="#{pedido.fecha}" >
                            <f:convertDateTime pattern="dd/MM/yyyy" type="date" timeZone="#{mbVentas.zonaHoraria.ID}" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Pedido" style="width: 6%;" >
                        <h:outputText value="#{pedido.idPedido}" />
                    </p:column>
                </p:dataTable>
            </p:panel>
        </h:form>
        <script type="text/javascript" >
            function handleEdicion(xhr, status, args) {
                if (!(args.validationFailed || !args.okEdicion)) {
                    PF('EdicionDlg').hide();
                }
            }
            function abrirEdicion(xhr, status, args) {
                if (!(args.validationFailed || !args.okEdicion)) {
                    PF('EdicionDlg').show();
                }
            }
            function handleSimilares(xhr, status, args) {
                if (!(args.validationFailed || !args.okSimilares)) {
                    PF('SimilaresDlg').hide();
                    PF('EdicionDlg').hide();
                }
            }
            function handleAbrirSimilares(xhr, status, args) {
                if (!(args.validationFailed || !args.okSimilares)) {
                    PF('SimilaresDlg').show();
                }
            }
            function handleBuscar(xhr, status, args) {
                if (!(args.validationFailed || !args.okBuscar)) {
                    PF('buscarProductoDlg').hide();
                }
            }
            function handlePedido(xhr, status, args) {
                if (!(args.validationFailed || !args.okPedido)) {
                    PF('pedidoDlg').hide();
                }
            }
            function abrirPedido(xhr, status, args) {
                if (!(args.validationFailed || !args.okPedido)) {
                    PF('pedidoDlg').show();
                }
            }
            function nuevoPedido(xhr, status, args) {
                if (!(args.validationFailed || !args.okNuevoPedido)) {
                    PF('nuevoPedidoDlg').hide();
                    PF('pedidoDlg').show();
                }
            }
        </script>
        <ui:include src="footer.html" />
    </body>
</html>
